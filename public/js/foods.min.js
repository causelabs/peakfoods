function getFoodList(){var e=$("#month").val(),t=$("#location").val();$("#noFoods").fadeOut();$.ajax({async:!0,url:jsBase+"/index/foods",type:"POST",data:"format=json&state="+t+"&month="+e,success:function(e){if(e.foods.length>0){var t="";$("#foods div.food").addClass("removeMe");for(var n in e.foods){var r=e.foods[n].id;if($("div#food"+r).length>0)$("div#food"+r+",div#recipe"+r+",div#nutrition"+r).removeClass("removeMe");else{t+='<div class="food overview '+e.foods[n].type+'" data-category="'+e.foods[n].type+'" id="food'+r+'" food="'+e.foods[n].name+'">'+'<h2 class="name" style="background-color:'+e.foods[n].background_color+'">'+e.foods[n].name+""+'<div class="buttons"><a href="#" class="recipeButton"><span>Recipes</span></a>';e.foods[n].nutrition&&(t+='<a href="#" class="nutritionButton"><span>Nutrition</span></a>');t+="</div></h2></div>";if(e.foods[n].nutrition&&!nutritionInfo[e.foods[n].name]){nutritionInfo[e.foods[n].name]=[];nutritionInfo[e.foods[n].name].header=e.foods[n].name+" <span>"+e.foods[n].nutrition.unit+"</span>";nutritionInfo[e.foods[n].name].content="";nutritionInfo[e.foods[n].name].content='<ul class="nutritionListLeft">';for(var i in nutritionListLeftItems)e.foods[n].nutrition[i]&&(nutritionInfo[e.foods[n].name].content+='<li><span class="left">'+nutritionListLeftItems[i]+'</span><span class="center"></span><span class="right">'+e.foods[n].nutrition[i]+(i=="calories"?"":"g")+"</span></li>");nutritionInfo[e.foods[n].name].content+='</ul><ul class="nutritionListRight">';for(i in nutritionListRightItems)e.foods[n].nutrition[i]&&(nutritionInfo[e.foods[n].name].content+='<li><span class="left">'+nutritionListRightItems[i]+'</span><span class="center"></span><span class="right">'+e.foods[n].nutrition[i]+"g</span></li>");nutritionInfo[e.foods[n].name].content+="</ul>"}}}removeItems=$(".removeMe");$("#foods").isotope("remove",removeItems);var s={filter:".overview"};$("#foods").isotope(s);t.length>0&&$("#foods").isotope("insert",$(t),function(){filterFoodTiles();$(".food").on("mouseenter",function(){$(this).children(".overview h2").addClass("fill")}).on("click",function(){$(this).children(".overview h2").addClass("fill")}).on("mouseleave",function(){$(this).children(".overview h2").removeClass("fill")});$(".recipeButton").on("click",function(){$(".recipe").show();var e=$(this).parents(".food").attr("id");e=e.replace(/[^0-9]/g,"");var t=e=$(this).parents(".food").css("background-color");s={filter:"#recipes"};$("#foods").isotope(s);var n=$(this).parents(".food").attr("food");$("#recipes .cardColorOverlay").css("background-color",t);$("#recipes").attr("food",n);$("#recipes h2").html("Recipes with "+n);scrollToTop();yummly.setRecipeCard(n,e);yummly.getRecipiesFromApi();return!1});$(".nutritionButton").on("click",function(){$(".nutrition").show();var e=$(this).parents(".food").attr("id");e=e.replace(/[^0-9]/g,"");var t=$(this).parents(".food").attr("food"),n=e=$(this).parents(".food").css("background-color");$("#nutritionInfo .cardColorOverlay").css("background-color",n);$("#nutritionInfo").attr("food",t);if(nutritionInfo[t]){$("#nutritionInfo h2").html(nutritionInfo[t].header);$("#nutritionContent").html(nutritionInfo[t].content);s={filter:"#nutritionInfo"};$("#foods").isotope(s)}scrollToTop();return!1});$(".closeButton").on("click",function(){yummly.setRecipeCard(null,null);filterFoodTiles();$("#foods").isotope("reLayout")})})}else{$("#noFoods").fadeIn("normal");removeItems=$("#foods div.food");removeItems.length>0&&$("#foods").isotope("remove",removeItems)}}})}function filterFoodTiles(){var e=$("#options .option-set"),t=e.find("a"),n=e.find(".selected"),r={},i=e.attr("data-option-key"),s=n.attr("data-option-value");s=s==="false"?!1:s;r[i]=s;i==="layoutMode"&&typeof changeLayoutMode=="function"?changeLayoutMode($this,r):$("#foods").isotope(r)}function positionSuccess(e){var t=e.coords.latitude,n=e.coords.longitude;codeLatLng(t,n)}function positionError(){getFoodList()}function codeLatLng(e,t){var n=new google.maps.LatLng(e,t),r;geocoder.geocode({latLng:n},function(e,t){if(t==google.maps.GeocoderStatus.OK)if(e[1]){for(var n=0;n<e[0].address_components.length;n++)for(var i=0;i<e[0].address_components[n].types.length;i++)if(e[0].address_components[n].types[i]=="administrative_area_level_1"){r=e[0].address_components[n];break}if(r){var s=r.short_name;$("#location").val(s);getFoodList()}}else getFoodList();else getFoodList()})}function scrollToTop(){$("html, body").animate({scrollTop:$("#foods").offset().top},1e3)}var facebookId,removeItems,nutritionListLeftItems={calories:"Calories",protein:"Protein",charbohydrate:"Carbohydrates",total_daily_fiber:"Fiber",sugar:"Sugar",calcium:"Calcium",iron:"Iron",magnesium:"Magnesium",phosphorus:"Phosphorus",potassium:"Potassium",sodium:"Sodium",zinc:"Zinc",copper:"Copper",manganese:"Manganese"},nutritionListRightItems={selenium:"Selenium",vitamin_c:"Vitamin C",thiamin:"Thiamin",riboflavin:"Riboflavin",niacin:"Niacin",vitamin_b12:"Vitamin B12",vitamin_a:"Vitamin A",vitamin_e:"Vitamin E",vitamin_k:"Vitamin K",saturated_fat:"Saturated Fat",mono_unsaturated_fat:"Mono-unsaturated Fat",poly_unsaturated_fat:"Poly-unsaturated Fat",cholesterol:"Cholesterol"},nutritionInfo=[],$foods,geocoder;$(function(){$foods=$("#foods");$foods.isotope({itemSelector:".food,#recipes,#nutritionInfo",getSortData:{name:function(e){try{var t=e.attr("food");return t}catch(n){return""}}},sortBy:"name"});var e=$("#options .option-set"),t=e.find("a");t.click(function(){var e=$(this);if(e.hasClass("selected"))return!1;var t=e.parents(".option-set");t.find(".selected").removeClass("selected");e.addClass("selected");filterFoodTiles();return!1});$(window).resize();$("#location,#month").bind("change",function(){getFoodList()});geocoder=new google.maps.Geocoder;navigator.geolocation?navigator.geolocation.getCurrentPosition(positionSuccess,positionError):getFoodList()});